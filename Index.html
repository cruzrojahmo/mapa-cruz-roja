<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PADSE - Cruz Roja Hermosillo</title>
    <link rel="icon" type="image/png" href="crhmologo.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --rojo-cr: #FF0000; 
            --sidebar-bg: #DEDEDE; 
            --bg-main: #F0F2F5;
            --text-color: #333;
            --card-bg: white;
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Inter', sans-serif; background-color: var(--bg-main); overflow: hidden; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 240px; background-color: #DEDEDE !important; display: flex; flex-direction: column; padding: 20px 0; flex-shrink: 0; z-index: 10; }
        .sidebar-logo { padding: 0 20px 20px 20px; text-align: center; }
        .sidebar-logo img { width: 160px; margin-bottom: 10px; }
        
        .nav-menu { list-style: none; padding: 0; margin: 0; }
        .nav-item { padding: 15px 25px; display: flex; align-items: center; font-size: 14px; color: #555 !important; cursor: pointer; transition: 0.3s; font-weight: 600; }
        .nav-item:hover { background: rgba(0,0,0,0.05); }
        .nav-item.active { background-color: #1a1a1a; color: white !important; border-left: 4px solid var(--rojo-cr); }

        .search-container { padding: 10px 15px; }
        .search-input { width: 100%; padding: 8px 12px; border-radius: 8px; border: 1px solid #bbb; font-size: 12px; outline: none; box-sizing: border-box; }
        
        .marquee-wrapper { flex-grow: 1; margin: 0 20px; background: #fffafa; border-radius: 10px; overflow: hidden; white-space: nowrap; display: flex; align-items: center; border: 1px solid #ffdada; height: 40px; }
        .marquee-text { display: inline-block; padding-left: 100%; animation: marquee-scroll 20s linear infinite; color: var(--rojo-cr); font-weight: 700; font-size: 13px; text-transform: uppercase; }
        @keyframes marquee-scroll { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        .main-content { flex-grow: 1; display: flex; flex-direction: column; padding: 20px; gap: 15px; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); padding: 12px 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .dashboard-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .map-container { flex-grow: 1; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        #map { width: 100%; height: 100%; }
        
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 20px; text-align: center; width: 320px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .login-btn { width: 100%; padding: 12px; background: var(--rojo-cr); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .login-input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <img src="crhmologo.png" alt="Logo" style="width: 150px; margin-bottom: 20px;">
        <input type="text" id="user-input" class="login-input" placeholder="Usuario" autocomplete="off">
        <input type="password" id="pass-input" class="login-input" placeholder="Contrase√±a">
        <button onclick="validarAcceso()" class="login-btn">INGRESAR</button>
    </div>
</div>

<div class="container">
    <div class="sidebar">
        <div class="sidebar-logo"><img src="crhmologo.png" alt="Logo"></div>
        <div class="search-container">
            <input type="text" class="search-input" id="address-search" placeholder="üîç Buscar direcci√≥n...">
        </div>
        <ul class="nav-menu">
            <li class="nav-item active">üìä Dashboard</li>
            <li class="nav-item" onclick="toggleUnidadesList()">üöë Unidades ‚ñæ</li>
            <div id="wrapper-unidades" style="display:none; background: #cecece;">
                <div id="lista-unidades-desplegable" style="max-height: 250px; overflow-y: auto;"></div>
            </div>
            <li class="nav-item" onclick="toggleHospitalList()">üè• Hospitales ‚ñæ</li>
            <div id="lista-hospitales-desplegable" style="display:none; background: #cecece; max-height: 250px; overflow-y: auto;"></div>
            <li class="nav-item" onclick="cerrarSesion()" style="color: #FF0000 !important; margin-top: 20px;">üö™ Cerrar Sesi√≥n</li>
        </ul>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div style="font-weight: 700; font-size: 13px;">SISTEMA PADSE | CRUZ ROJA</div>
            <div class="marquee-wrapper">
                <div class="marquee-text" id="marquee-content">Sincronizando monitoreo vial...</div>
            </div>
            <div id="clock-now" style="color:var(--rojo-cr); font-size:20px; font-weight:bold;">00:00:00</div>
        </div>

        <div class="dashboard-grid">
            <div class="stat-card">
                <div style="font-size: 11px; opacity: 0.7;">ALERTAS</div>
                <div id="alerta-status" style="font-size: 18px; font-weight:700; color: #2ecc71;">SIN ALERTAS</div>
            </div>
            <div class="stat-card">
                <div style="font-size: 11px; opacity: 0.7;">CLIMA</div>
                <div id="clima-info" style="font-size: 22px; font-weight:700;">--¬∞C</div>
            </div>
            <div class="stat-card">
                <div style="font-size: 11px; opacity: 0.7;">OPERATIVIDAD</div>
                <div style="font-size: 22px; font-weight:700; color: #2ecc71;">100%</div>
            </div>
        </div>
        <div class="map-container"><div id="map"></div></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // URLS
    const UNIDADES_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4_Q6g0WAkAHw8t7ZONnY_xppTfxr0Gh736C9IwPgDIM4P2-zDsiPau4HGtACULSg13LlAPuZgbiR8/pub?output=csv';
    const SHEET_HOSPITALES_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTh7H5-srU1-anbqTEuHtC5BYciljJuqQP36afOD7OouN9jqeBHvHiMfRdGmHCdRG_MX2bGPoOjws07/pub?output=csv';
    const API_CLIMA = "b99d75364d37e9fd2bedb86b7e42743e";

    // MAPA
    var map = L.map('map', { center: [29.09, -110.96], zoom: 13, zoomControl: false });
    L.tileLayer('https://{s}.google.com/vt/lyrs=m,traffic&x={x}&y={y}&z={z}', { maxZoom: 20, subdomains: ['mt0', 'mt1', 'mt2', 'mt3'] }).addTo(map);
    var hospitalLayer = L.layerGroup().addTo(map);
    const hospIcon = L.icon({ iconUrl: "placeholder.png", iconSize: [30, 30] });

    function validarAcceso() {
        const u = document.getElementById('user-input').value.trim();
        const p = document.getElementById('pass-input').value.trim();
        if(u === "cruzoja_1" && p === "padsecrhmo26") {
            document.getElementById('login-overlay').style.display = 'none';
        } else {
            alert("Acceso Denegado");
        }
    }

    async function cargarUnidades() {
        try {
            const resp = await fetch(UNIDADES_CSV_URL);
            const data = await resp.text();
            const filas = data.split(/\r?\n/).slice(1);
            const listaDiv = document.getElementById('lista-unidades-desplegable');
            listaDiv.innerHTML = '';
            filas.forEach(fila => {
                const c = fila.split(',');
                if(c.length >= 2) {
                    const item = document.createElement('div');
                    item.style = "padding:12px; font-size:12px; border-bottom:1px solid #bbb; color:#333;";
                    item.innerHTML = `<b>${c[0]}</b> - ${c[1]}`;
                    listaDiv.appendChild(item);
                }
            });
        } catch(e) { console.error("Error unidades:", e); }
    }

    async function obtenerClima() {
        try {
            const resp = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=29.08&lon=-110.96&units=metric&appid=${API_CLIMA}&lang=es`);
            const data = await resp.json();
            document.getElementById('clima-info').innerText = `${Math.round(data.main.temp)}¬∞C`;
        } catch(e) {}
    }

    async function cargarHospitales() {
        try {
            const resp = await fetch(SHEET_HOSPITALES_URL);
            const data = await resp.text();
            const filas = data.split(/\r?\n/).slice(1);
            const listaDiv = document.getElementById('lista-hospitales-desplegable');
            listaDiv.innerHTML = ''; hospitalLayer.clearLayers();
            filas.forEach(fila => {
                const c = fila.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if(c.length >= 4) {
                    const nombre = c[0].replace(/"/g, "").trim();
                    const lat = parseFloat(c[1]); const lng = parseFloat(c[2]);
                    const cap = c[3].replace(/"/g, "").trim();
                    L.marker([lat, lng], {icon: hospIcon}).bindPopup(`<b>${nombre}</b><br>${cap}`).addTo(hospitalLayer);
                    const item = document.createElement('div');
                    item.style = "padding:10px; font-size:11px; border-bottom:1px solid #bbb; cursor:pointer; color:#333;";
                    item.innerHTML = `<b>${nombre}</b><br><small>${cap}</small>`;
                    item.onclick = () => map.flyTo([lat, lng], 16);
                    listaDiv.appendChild(item);
                }
            });
        } catch(e) {}
    }

    // 51 CRUCEROS
    const puntosCriticos = [
        { nombre: "CLOUTHIER Y LIBERTAD", lat: 29.0432, lng: -110.9705 },
        { nombre: "SOLIDARIDAD Y VILDOSOLA", lat: 29.0628, lng: -110.9562 },
        { nombre: "GANADEROS Y PERIF√âRICO SUR", lat: 29.0495, lng: -110.9412 },
        { nombre: "AV. L√ÅZARO C√ÅRDENAS (SUR) Y SOLIDARIDAD", lat: 29.0520, lng: -110.9710 },
        { nombre: "FRANCISCO VILLA Y SOLIDARIDAD", lat: 29.0585, lng: -110.9720 },
        { nombre: "CAMINO DEL SERI Y SOLIDARIDAD", lat: 29.0645, lng: -110.9735 },
        { nombre: "REFORMA Y R√çO SONORA", lat: 29.0720, lng: -110.9590 },
        { nombre: "SOLIDARIDAD Y CULTURA", lat: 29.0715, lng: -110.9740 },
        { nombre: "SOLIDARIDAD Y R√çO SONORA", lat: 29.0735, lng: -110.9745 },
        { nombre: "SOLIDARIDAD Y SERNA", lat: 29.0770, lng: -110.9750 },
        { nombre: "SOLIDARIDAD Y OLIVARES", lat: 29.0815, lng: -110.9760 },
        { nombre: "REFORMA Y COLOSIO", lat: 29.0845, lng: -110.9605 },
        { nombre: "CULTURA Y VILDOSOLA", lat: 29.0685, lng: -110.9545 },
        { nombre: "ROSALES Y CUCURPE", lat: 29.0710, lng: -110.9525 },
        { nombre: "PINO SU√ÅREZ Y MIGUEL HIDALGO", lat: 29.0785, lng: -110.9515 },
        { nombre: "ROSALES Y MIGUEL HIDALGO", lat: 29.0805, lng: -110.9535 },
        { nombre: "COLOSIO Y ROSALES", lat: 29.0835, lng: -110.9540 },
        { nombre: "COLOSIO Y PINO SU√ÅREZ", lat: 29.0825, lng: -110.9525 },
        { nombre: "PINO SU√ÅREZ Y LUIS ENCINAS", lat: 29.0875, lng: -110.9530 },
        { nombre: "LUIS ENCINAS Y ROSALES", lat: 29.0885, lng: -110.9550 },
        { nombre: "REFORMA Y NAVARRETE", lat: 29.0880, lng: -110.9615 },
        { nombre: "LUIS ENCINAS Y REFORMA", lat: 29.0910, lng: -110.9620 },
        { nombre: "ABELARDO L. RODR√çGUEZ Y MORELOS", lat: 29.0965, lng: -110.9490 },
        { nombre: "EUSEBIO KINO Y G√ìMEZ FAR√çAS", lat: 29.1025, lng: -110.9430 },
        { nombre: "PERIF√âRICO ORIENTE Y EUSEBIO KINO", lat: 29.1120, lng: -110.9255 },
        { nombre: "COLOSIO Y SOLIDARIDAD", lat: 29.0850, lng: -110.9775 },
        { nombre: "SOLIDARIDAD Y NAVARRETE", lat: 29.0890, lng: -110.9785 },
        { nombre: "SOLIDARIDAD Y LUIS ENCINAS", lat: 29.0935, lng: -110.9800 },
        { nombre: "SOLIDARIDAD Y ENRIQUE QUIJADA", lat: 29.1020, lng: -110.9825 },
        { nombre: "SOLIDARIDAD Y PERIMETRAL NORTE", lat: 29.1095, lng: -110.9835 },
        { nombre: "SOLIDARIDAD Y IGNACIO SALAZAR", lat: 29.1165, lng: -110.9845 },
        { nombre: "SOLIDARIDAD Y L√ÅZARO C√ÅRDENAS (NORTE)", lat: 29.1235, lng: -110.9855 },
        { nombre: "SOLIDARIDAD Y REBEICO", lat: 29.1310, lng: -110.9865 },
        { nombre: "SOLIDARIDAD Y J.B. ESCALANTE", lat: 29.1415, lng: -110.9880 },
        { nombre: "COLOSIO Y PASEO LAS QUINTAS", lat: 29.0865, lng: -111.0010 },
        { nombre: "COLOSIO Y QUINTERO ARCE", lat: 29.0880, lng: -111.0175 },
        { nombre: "COLOSIO Y QUIROGA", lat: 29.0895, lng: -111.0335 },
        { nombre: "NAVARRETE Y QUIROGA", lat: 29.0945, lng: -111.0345 },
        { nombre: "NAVARRETE Y QUINTERO ARCE", lat: 29.0930, lng: -111.0185 },
        { nombre: "QUIROGA Y GARC√çA MORALES", lat: 29.1015, lng: -111.0360 },
        { nombre: "QUIROGA Y PERIMETRAL", lat: 29.1135, lng: -111.0385 },
        { nombre: "QUIROGA Y DE LOS YAQUIS", lat: 29.1190, lng: -111.0395 },
        { nombre: "QUIROGA Y NAVOJOA", lat: 29.1250, lng: -111.0410 },
        { nombre: "QUIROGA Y GASPAR LUKEN", lat: 29.1310, lng: -111.0425 },
        { nombre: "QUIROGA Y L√ÅZARO C√ÅRDENAS (NORTE)", lat: 29.1395, lng: -111.0445 },
        { nombre: "QUIROGA Y J.B. ESCALANTE", lat: 29.1465, lng: -111.0460 },
        { nombre: "OLIVARES Y J.B. ESCALANTE", lat: 29.1435, lng: -110.9745 },
        { nombre: "REFORMA Y J.B. ESCALANTE", lat: 29.1445, lng: -110.9635 },
        { nombre: "J.B. ESCALANTE Y MORELOS NORTE", lat: 29.1480, lng: -110.9385 },
        { nombre: "MORELOS Y L√ìPEZ PORTILLO", lat: 29.1275, lng: -110.9465 },
        { nombre: "MORELOS Y PERIF√âRICO NORTE", lat: 29.1105, lng: -110.9435 }
    ];

    function toggleUnidadesList() {
        const d = document.getElementById('wrapper-unidades');
        d.style.display = d.style.display === 'none' ? 'block' : 'none';
        if(d.style.display === 'block') cargarUnidades();
    }

    function toggleHospitalList() {
        const d = document.getElementById('lista-hospitales-desplegable');
        d.style.display = d.style.display === 'none' ? 'block' : 'none';
        if(d.style.display === 'block') cargarHospitales();
    }

    window.onload = () => {
        setInterval(() => { document.getElementById('clock-now').innerText = new Date().toLocaleTimeString(); }, 1000);
        obtenerClima();
        cargarHospitales();
        setInterval(obtenerClima, 1800000);
    };

    function cerrarSesion() { location.reload(); }
</script>
</body>
</html>
