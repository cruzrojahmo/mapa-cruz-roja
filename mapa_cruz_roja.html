<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Cruz Roja Hermosillo - Centro de Monitoreo</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #F4F4F4;
}

#map {
    height: 100vh;
}

.panel {
    position: absolute;
    top: 10px;
    background: white;
    padding: 12px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    z-index: 1000;
}

#filtros { left: 10px; width: 220px; }
#info { right: 10px; width: 220px; }

h3 { margin-top: 0; color: #C8102E; }
</style>
</head>

<body>

<div id="map"></div>

<div id="filtros" class="panel">
<h3>Filtros</h3>
<p>Ubicaci贸n en tiempo real activa</p>
</div>

<div id="info" class="panel">
<h3>Unidad</h3>
<p><b>Estado:</b> En l铆nea</p>
<p><b>GPS:</b> Activo</p>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// Crear mapa en Hermosillo
var map = L.map('map').setView([29.0729, -110.9559], 13);

// Capa base
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '漏 OpenStreetMap'
}).addTo(map);

// Icono de ambulancia
var ambulanciaIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/2967/2967350.png",
    iconSize: [40, 40],
    iconAnchor: [20, 20]
});

var marcadorAmbulancia = null;

// Funci贸n de actualizaci贸n GPS
function actualizarPosicion(pos) {
    var lat = pos.coords.latitude;
    var lng = pos.coords.longitude;

    if (!marcadorAmbulancia) {
        marcadorAmbulancia = L.marker([lat, lng], {icon: ambulanciaIcon})
            .addTo(map)
            .bindPopup(" Unidad en servicio");
    } else {
        marcadorAmbulancia.setLatLng([lat, lng]);
    }

    map.setView([lat, lng], 15);
}

// Manejo de errores
function errorGPS(err) {
    alert("No se pudo obtener GPS. Activa ubicaci贸n en el navegador.");
}

// Activar seguimiento en tiempo real
if (navigator.geolocation) {
    navigator.geolocation.watchPosition(actualizarPosicion, errorGPS, {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: 5000
    });
} else {
    alert("Tu navegador no soporta geolocalizaci贸n.");
}
</script>

</body>
</html>
