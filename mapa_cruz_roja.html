<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Centro de Despacho ‚Äì Cruz Roja Hermosillo</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body { margin:0; font-family: Arial; background:#0f172a; }
#map { height:100vh; }

.panel {
 position:absolute;
 top:10px;
 right:10px;
 width:260px;
 background:white;
 padding:12px;
 border-radius:10px;
 box-shadow:0 4px 12px rgba(0,0,0,.3);
 z-index:1000;
}

h3 { margin:0 0 8px; color:#C8102E; }
.estado { font-weight:bold; }
</style>
</head>

<body>

<div id="map"></div>

<div class="panel">
<h3>Estado hospitalario</h3>
<div id="hospitalesLista"></div>
<hr>
<h3>Clima actual</h3>
<div id="clima"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
// ================= MAPA BASE =================
const map = L.map('map').setView([29.0729,-110.9559],12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
 attribution:'¬© OpenStreetMap'
}).addTo(map);

// ================= ICONO AMBULANCIA =================
const iconAmb = L.icon({
 iconUrl:"https://cdn-icons-png.flaticon.com/512/2967/2967350.png",
 iconSize:[28,28]
});

// ================= 20 AMBULANCIAS EN VIVO (SIMULADAS) =================
const ambulancias = [];
for(let i=0;i<20;i++){
 const lat = 29.07 + (Math.random()-0.5)*0.1;
 const lng = -110.95 + (Math.random()-0.5)*0.1;

 const m = L.marker([lat,lng],{icon:iconAmb})
   .addTo(map)
   .bindPopup("Unidad CR-"+(i+1));

 ambulancias.push(m);
}

// Movimiento autom√°tico cada 5 s
setInterval(()=>{
 ambulancias.forEach(m=>{
   const p = m.getLatLng();
   const lat = p.lat + (Math.random()-0.5)*0.005;
   const lng = p.lng + (Math.random()-0.5)*0.005;
   m.setLatLng([lat,lng]);
 });
},5000);

// ================= HOSPITALES =================
const hospitales = [
 {n:"HGE",lat:29.09,lng:-110.963,e:"verde"},
 {n:"IMSS 14",lat:29.075,lng:-110.938,e:"amarillo"},
 {n:"ISSSTE",lat:29.084,lng:-110.97,e:"rojo"},
 {n:"CIMA",lat:29.10,lng:-110.95,e:"verde"}
];

function color(e){
 if(e==="verde") return "#22c55e";
 if(e==="amarillo") return "#facc15";
 return "#ef4444";
}

hospitales.forEach(h=>{
 L.circleMarker([h.lat,h.lng],{
  radius:10,
  color:color(h.e),
  fillOpacity:.9
 }).addTo(map).bindPopup(h.n);

 const div=document.createElement("div");
 div.innerHTML=`${h.n}: <span class="estado" style="color:${color(h.e)}">${h.e}</span>`;
 hospitalesLista.appendChild(div);
});

// ================= HEATMAP DE SERVICIOS =================
const puntos=[];
for(let i=0;i<80;i++){
 puntos.push([
 29.07+(Math.random()-0.5)*0.15,
 -110.95+(Math.random()-0.5)*0.15,
 Math.random()
 ]);
}

L.heatLayer(puntos,{radius:25}).addTo(map);

// ================= CLIMA REAL =================
// ‚ö†Ô∏è usa tu propia API gratuita luego
const API="https://api.open-meteo.com/v1/forecast?latitude=29.07&longitude=-110.95&current_weather=true";

fetch(API)
 .then(r=>r.json())
 .then(d=>{
   const t=d.current_weather.temperature;
   const v=d.current_weather.windspeed;
   clima.innerHTML=`üå°Ô∏è ${t} ¬∞C<br>üí® Viento ${v} km/h`;
 });

</script>
</body>
</html>
